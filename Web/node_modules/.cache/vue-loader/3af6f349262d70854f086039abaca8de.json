{"remainingRequest":"E:\\NetModular.CodeGenerator\\src\\UI\\module-codegenerator\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\NetModular.CodeGenerator\\src\\UI\\module-codegenerator\\node_modules\\netmodular-module-admin\\src\\views\\role\\components\\platform-bind\\index.vue?vue&type=script&lang=js","dependencies":[{"path":"E:\\NetModular.CodeGenerator\\src\\UI\\module-codegenerator\\node_modules\\netmodular-module-admin\\src\\views\\role\\components\\platform-bind\\index.vue","mtime":1706623138842},{"path":"E:\\NetModular.CodeGenerator\\src\\UI\\module-codegenerator\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1706623138253},{"path":"E:\\NetModular.CodeGenerator\\src\\UI\\module-codegenerator\\node_modules\\babel-loader\\lib\\index.js","mtime":1706623138119},{"path":"E:\\NetModular.CodeGenerator\\src\\UI\\module-codegenerator\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1706623138253},{"path":"E:\\NetModular.CodeGenerator\\src\\UI\\module-codegenerator\\node_modules\\vue-loader\\lib\\index.js","mtime":1706623133543}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQgeyBtaXhpbnMgfSBmcm9tICduZXRtb2R1bGFyLXVpJw0KY29uc3QgYXBpID0gJGFwaS5hZG1pbi5wZXJtaXNzaW9uDQpjb25zdCB7IHF1ZXJ5QmluZFBsYXRmb3JtUGVybWlzc2lvbnMsIGJpbmRQbGF0Zm9ybVBlcm1pc3Npb25zIH0gPSAkYXBpLmFkbWluLnJvbGUNCmV4cG9ydCBkZWZhdWx0IHsNCiAgbWl4aW5zOiBbbWl4aW5zLnZpc2libGVdLA0KICBkYXRhKCkgew0KICAgIHJldHVybiB7DQogICAgICB0cmVlOiB7DQogICAgICAgIGRhdGE6IFtdLA0KICAgICAgICBub2RlS2V5OiAnaWQnLA0KICAgICAgICBkZWZhdWx0RXhwYW5kQWxsOiB0cnVlLA0KICAgICAgICBzaG93Q2hlY2tib3g6IHRydWUNCiAgICAgIH0sDQogICAgICBwbGF0Zm9ybTogMSwNCiAgICAgIGxvYWRpbmc6IGZhbHNlLA0KICAgICAgcGVybWlzc2lvbnM6IFtdDQogICAgfQ0KICB9LA0KICBwcm9wczogew0KICAgIGlkOiBTdHJpbmcNCiAgfSwNCiAgbWV0aG9kczogew0KICAgIHF1ZXJ5UGVybWlzc2lvblRyZWUoKSB7DQogICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlDQogICAgICBhcGkNCiAgICAgICAgLnRyZWUoKQ0KICAgICAgICAudGhlbihkYXRhID0+IHsNCiAgICAgICAgICB0aGlzLnRyZWUuZGF0YSA9IFtkYXRhXQ0KICAgICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlDQogICAgICAgIH0pDQogICAgICAgIC5jYXRjaCgoKSA9PiB7DQogICAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2UNCiAgICAgICAgfSkNCiAgICB9LA0KICAgIHF1ZXJ5QmluZFBsYXRmb3JtUGVybWlzc2lvbnMoKSB7DQogICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlDQogICAgICBxdWVyeUJpbmRQbGF0Zm9ybVBlcm1pc3Npb25zKHsgcm9sZUlkOiB0aGlzLmlkLCBwbGF0Zm9ybTogdGhpcy5wbGF0Zm9ybSB9KS50aGVuKGRhdGEgPT4gew0KICAgICAgICB0aGlzLnBlcm1pc3Npb25zID0gZGF0YQ0KICAgICAgICB0aGlzLnJlc2V0KCkNCiAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2UNCiAgICAgIH0pDQogICAgfSwNCiAgICBzYXZlKCkgew0KICAgICAgbGV0IHBlcm1pc3Npb25zID0gdGhpcy4kcmVmcy50cmVlDQogICAgICAgIC5nZXRDaGVja2VkTm9kZXMoKQ0KICAgICAgICAuZmlsdGVyKG0gPT4gbS5pdGVtLmlzUGVybWlzc2lvbikNCiAgICAgICAgLm1hcChtID0+IHsNCiAgICAgICAgICByZXR1cm4gbS5pdGVtLmNvZGUNCiAgICAgICAgfSkNCiAgICAgIHRoaXMubG9hZGluZyA9IHRydWUNCiAgICAgIGJpbmRQbGF0Zm9ybVBlcm1pc3Npb25zKHsgcm9sZUlkOiB0aGlzLmlkLCBwbGF0Zm9ybTogdGhpcy5wbGF0Zm9ybSwgcGVybWlzc2lvbnMgfSkNCiAgICAgICAgLnRoZW4oKCkgPT4gew0KICAgICAgICAgIHRoaXMuX3N1Y2Nlc3MoJ+S/neWtmOaIkOWKnycpDQogICAgICAgICAgdGhpcy5wZXJtaXNzaW9ucyA9IHBlcm1pc3Npb25zDQogICAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2UNCiAgICAgICAgfSkNCiAgICAgICAgLmNhdGNoKCgpID0+IHsNCiAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZQ0KICAgICAgICB9KQ0KICAgIH0sDQogICAgcmVzZXQoKSB7DQogICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7DQogICAgICAgIHRoaXMuJHJlZnMudHJlZS5zZXRDaGVja2VkS2V5cyh0aGlzLnBlcm1pc3Npb25zKQ0KICAgICAgfSkNCiAgICB9DQogIH0sDQogIGNyZWF0ZWQoKSB7DQogICAgdGhpcy5xdWVyeVBlcm1pc3Npb25UcmVlKCkNCiAgICB0aGlzLnF1ZXJ5QmluZFBsYXRmb3JtUGVybWlzc2lvbnMoKQ0KICB9LA0KICB3YXRjaDogew0KICAgIGlkKCkgew0KICAgICAgdGhpcy5wbGF0Zm9ybSA9IDENCiAgICAgIHRoaXMucXVlcnlCaW5kUGxhdGZvcm1QZXJtaXNzaW9ucygpDQogICAgfQ0KICB9DQp9DQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AA2BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"node_modules/netmodular-module-admin/src/views/role/components/platform-bind","sourcesContent":["<template>\r\n  <nm-box page :header=\"false\" footer :loading=\"loading\">\r\n    <el-alert title=\"提示\" type=\"warning\" class=\"nm-m-10\" description=\"平台授权是给Web平台以外的平台绑定权限使用的，比如安卓、IOS、小程序等等\" show-icon> </el-alert>\r\n    <el-form label-width=\"100px\">\r\n      <el-form-item style=\"width:500px;margin:15px 0;\" label=\"选择平台：\">\r\n        <nm-platform-select v-model=\"platform\" no-web @change=\"queryBindPlatformPermissions\" :clearable=\"false\" />\r\n      </el-form-item>\r\n    </el-form>\r\n    <el-tree ref=\"tree\" v-bind=\"tree\">\r\n      <span slot-scope=\"{ data }\">\r\n        <nm-icon name=\"attachment\" />\r\n        <span class=\"nm-m-l-5\"\r\n          >{{ data.label\r\n          }}<label v-if=\"data.item.isPermission\" class=\"nm-p-l-5 nm-text-info nm-size-14\" style=\"font-style: italic;\"\r\n            >(<label>{{ data.item.code }}</label\r\n            >)</label\r\n          ></span\r\n        >\r\n      </span>\r\n    </el-tree>\r\n    <template v-slot:footer>\r\n      <nm-button type=\"success\" text=\"保存\" @click=\"save\" />\r\n      <nm-button type=\"info\" text=\"重置\" @click=\"reset\" />\r\n    </template>\r\n  </nm-box>\r\n</template>\r\n<script>\r\nimport { mixins } from 'netmodular-ui'\r\nconst api = $api.admin.permission\r\nconst { queryBindPlatformPermissions, bindPlatformPermissions } = $api.admin.role\r\nexport default {\r\n  mixins: [mixins.visible],\r\n  data() {\r\n    return {\r\n      tree: {\r\n        data: [],\r\n        nodeKey: 'id',\r\n        defaultExpandAll: true,\r\n        showCheckbox: true\r\n      },\r\n      platform: 1,\r\n      loading: false,\r\n      permissions: []\r\n    }\r\n  },\r\n  props: {\r\n    id: String\r\n  },\r\n  methods: {\r\n    queryPermissionTree() {\r\n      this.loading = true\r\n      api\r\n        .tree()\r\n        .then(data => {\r\n          this.tree.data = [data]\r\n          this.loading = false\r\n        })\r\n        .catch(() => {\r\n          this.loading = false\r\n        })\r\n    },\r\n    queryBindPlatformPermissions() {\r\n      this.loading = true\r\n      queryBindPlatformPermissions({ roleId: this.id, platform: this.platform }).then(data => {\r\n        this.permissions = data\r\n        this.reset()\r\n        this.loading = false\r\n      })\r\n    },\r\n    save() {\r\n      let permissions = this.$refs.tree\r\n        .getCheckedNodes()\r\n        .filter(m => m.item.isPermission)\r\n        .map(m => {\r\n          return m.item.code\r\n        })\r\n      this.loading = true\r\n      bindPlatformPermissions({ roleId: this.id, platform: this.platform, permissions })\r\n        .then(() => {\r\n          this._success('保存成功')\r\n          this.permissions = permissions\r\n          this.loading = false\r\n        })\r\n        .catch(() => {\r\n          this.loading = false\r\n        })\r\n    },\r\n    reset() {\r\n      this.$nextTick(() => {\r\n        this.$refs.tree.setCheckedKeys(this.permissions)\r\n      })\r\n    }\r\n  },\r\n  created() {\r\n    this.queryPermissionTree()\r\n    this.queryBindPlatformPermissions()\r\n  },\r\n  watch: {\r\n    id() {\r\n      this.platform = 1\r\n      this.queryBindPlatformPermissions()\r\n    }\r\n  }\r\n}\r\n</script>\r\n"]}]}